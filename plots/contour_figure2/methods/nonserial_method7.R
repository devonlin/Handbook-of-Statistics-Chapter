rm(list=ls()) 
#-------------------------------------------------------------------------------
#Packages
#-------------------------------------------------------------------------------
library(lhs)
library(EzGP)
library(laGP)
#serial job
l=24
#-------------------------------------------------------------------------------
#initial data
#-------------------------------------------------------------------------------
method_name="one-shot"
print(method_name)
load("initial.RData")
#-------------------------------------------------------------------------------
#measurements and time
#-------------------------------------------------------------------------------
Y_hat_save=c()
Yhat_stage=matrix(NA,nrow=n_M_c0*prod(m),nnew)
#-------------------------------------------------------------------------------
#simulations
#-------------------------------------------------------------------------------
  print(l)#print nsim
#-------------------------------------------------------------------------------
#data
#-------------------------------------------------------------------------------
x=randomLHS(N,p)
if(q==1){ 
  z_true=matrix(1:m,ncol=q)
  z=matrix(apply(z_true,2,rep,N)[1:N,],ncol=q)
}else{   
  z=apply(z_true,2,rep,N)[1:N,]
}   
id_z=sample(1:N,N)
z=z[id_z,]
XZ= cbind(x, z)
y= computer_simulator(XZ)
n0_dat=cbind(XZ,y)
#-------------------------------------------------------------------------------
#Measurements
#-------------------------------------------------------------------------------    
#min|y-a|     
  for(i in 1:nnew){
    print(i)
    model = EzGP_fit(n0_dat[1:(n0+i),1:(p+q)],n0_dat[1:(n0+i),(p+q+1)],p=p,q=q,m=m,tau = tau) 
    
    
    #predictions  
    pred= EzGP_predict(Data_M_c0_XZ, model, MSE_on = 0)
    Yhat_stage[,i] = pred$Y_hat
    
    
  }


save.image("oneshot.Rdata")
